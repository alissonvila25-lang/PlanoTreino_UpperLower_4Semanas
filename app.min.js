// Minimal runtime v30: loads CSVs and renders a simple list
(function(){
  const PLAN = './plano-4-semanas.csv';
  function fetchText(u){return fetch(u).then(r=>{if(!r.ok)throw new Error('HTTP '+r.status);return r.text();});}
  function parse(t){return Papa.parse(t,{header:true,skipEmptyLines:true}).data}
  Promise.all([fetchText(PLAN)]).then(([p])=>{
    const rows = parse(p);
    const root = document.getElementById('exercise-list'); if(!root) return;
    root.innerHTML = '';
    const grouped = {};
    rows.forEach(r=>{const day = r.Dia||r.Day||'Dia'; if(!grouped[day]) grouped[day]=[]; grouped[day].push(r);});
    Object.keys(grouped).forEach(day=>{
      const card=document.createElement('div'); card.className='card'; const h=document.createElement('h3'); h.textContent=day; card.appendChild(h);
      grouped[day].forEach(ex=>{ const p=document.createElement('p'); p.textContent = (ex.Exercicio||ex.Exercise||'') + ' — ' + (ex.SeriesBase||ex.Sets||'') + ' x ' + (ex.Reps||''); card.appendChild(p); });
      root.appendChild(card);
    });
  }).catch(e=>{const r=document.getElementById('exercise-list'); if(r) r.innerHTML='<div class="card">Erro ao carregar dados.</div>';});
})();
// Minimal app runtime (v30)
(function(){
  const CSV_PLAN = './plano-4-semanas.csv';
  const CSV_TECH = './tecnicas.csv';

  function fetchText(url){
    return fetch(url).then(r=>{
      if(!r.ok) throw new Error('HTTP '+r.status);
      return r.text();
    });
  }

  function parseCSV(text){
    return Papa.parse(text, { header: true, skipEmptyLines: true }).data;
  }

  Promise.all([fetchText(CSV_PLAN), fetchText(CSV_TECH)])
    .then(([planTxt, techTxt]) => {
      const plan = parseCSV(planTxt);
      const tech = parseCSV(techTxt);
      renderPlan(plan, tech);
    })
    .catch(err => {
      console.error('Erro ao carregar CSVs', err);
      document.getElementById('exercise-list').innerHTML = '<div class="card">Falha ao carregar dados.</div>';
    });

  function renderPlan(planRows, techniques){
    const root = document.getElementById('exercise-list');
    if(!root) return;
    root.innerHTML = '';

    const grouped = {};
    planRows.forEach(r => {
      const day = r.Day || r.Dia || 'Dia?';
      if(!grouped[day]) grouped[day] = [];
      grouped[day].push(r);
    });

    Object.keys(grouped).forEach(day => {
      const card = document.createElement('div');
      card.className = 'card';
      const h = document.createElement('h3');
      h.textContent = day;
      card.appendChild(h);

      grouped[day].forEach(ex => {
        const p = document.createElement('p');
        p.textContent = `${ex.Exercise || ex.Exercicio || ex.Name || ''} — ${ex.Sets || ex.Series || ''} x ${ex.Reps || ex.Repeticoes || ''}`;
        card.appendChild(p);
      });

      root.appendChild(card);
    });
  }

})();
// Minimal app v1: carrega CSVs e renderiza lista simples
(async function(){
  function sanitize(s){ return s==null? '': String(s); }
  function decode(ab){ try { return new TextDecoder('utf-8').decode(ab); } catch(e){ return new TextDecoder('windows-1252').decode(ab); } }
  async function fetchBuf(p){ const r = await fetch(p); if(!r.ok) throw new Error('fetch fail '+p); return r.arrayBuffer(); }
  try {
    const planBuf = await fetchBuf('./plano-4-semanas.csv');
    const techBuf = await fetchBuf('./tecnicas.csv');
    const ptext = decode(planBuf); const ttext = decode(techBuf);
    const plan = Papa.parse(ptext, { header: true, skipEmptyLines: true }).data;
    const tech = Papa.parse(ttext, { header: true, skipEmptyLines: true }).data;
    const root = document.getElementById('exercise-list');
    if(!root) return;
    root.innerHTML = '';
    const weekSel = document.getElementById('week-select');
    const daySel = document.getElementById('day-select');
    function render(){
      const week = Number(weekSel.value||1);
      const day = daySel.value || 'Segunda';
      const list = plan.filter(r => sanitize(r.Dia) === day);
      if(!list.length) { root.innerHTML = '<div class="card">Nenhum exercício para o dia.</div>'; return; }
      root.innerHTML = list.map(r => `<div class="card"><strong>${sanitize(r.Exercicio)}</strong><div class="meta">${sanitize(r.Protocolo)} • Pausa: ${sanitize(r.Pausa)}</div></div>`).join('');
    }
    weekSel.addEventListener('change', render);
    daySel.addEventListener('change', render);
    render();
  } catch(e){ console.error(e); const root = document.getElementById('exercise-list'); if(root) root.innerHTML = '<div class="card">Erro ao carregar dados.</div>'; }
})();
